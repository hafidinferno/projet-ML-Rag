version: '3.8'

services:
  # ===========================================================================
  # Fraud Agent API
  # ===========================================================================
  fraud-agent-api:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: fraud-agent-api
    ports:
      - "8000:8000"
    environment:
      - OLLAMA_BASE_URL=http://host.docker.internal:11434
      - DOCS_DIR=/app/data/docs
      - VECTORDB_DIR=/app/vectordb
      - LOGS_DIR=/app/logs
    volumes:
      # Mount documents directory
      - ./data/docs:/app/data/docs:ro
      # Persist vector database
      - ./vectordb:/app/vectordb
      # Persist logs
      - ./logs:/app/logs
    restart: unless-stopped
    extra_hosts:
      - "host.docker.internal:host-gateway"
    healthcheck:
      test: [ "CMD", "curl", "-f", "http://localhost:8000/health" ]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s

  # ===========================================================================
  # n8n (Optional - can use external instance)
  # ===========================================================================
  n8n:
    image: n8nio/n8n:latest
    container_name: fraud-agent-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=true
      - N8N_BASIC_AUTH_USER=admin
      - N8N_BASIC_AUTH_PASSWORD=changeme
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
    volumes:
      - n8n_data:/home/node/.n8n
    restart: unless-stopped
    depends_on:
      - fraud-agent-api

volumes:
  n8n_data:


networks:
  default:
    name: fraud-agent-network
